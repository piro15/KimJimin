<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="6ê°•.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>

  <!--ìŠ¤í”„ë ˆë“œ ì •ë¦¬
ë‘ ê°œì˜ ë°°ì—´ì„ ê²°í•©í•  ë•Œ concat ëŒ€ì‹ .&ë” ë‹¤ì–‘í•œ í˜•íƒœë¡œ.
ë°°ì—´ ì°¸ì¡° ë§ê³  ë³µì‚¬í•˜ê³  ì‹¶ì„ ë•Œ slice, map ëŒ€ì‹ . ìƒˆë¡œìš´ ë³µì‚¬ëœ ë°°ì—´ ìƒì„±.
rest parameter: í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ í•¨ìˆ˜ì˜ íŒŒë¼ë¯¸í„°ë¥¼ spread operatorë¡œ ì‘ì„±í•œ í˜•íƒœ. 
    í•¨ìˆ˜ì˜ íŒŒë¼ë¯¸í„°ë¡œ ì˜¤ëŠ” ê°’ë“¤ì„ ëª¨ì•„ ë°°ì—´ì— ë„£ëŠ”ë‹¤.
í•¨ìˆ˜ í˜¸ì¶œ ì¸ìë¡œ ì‚¬ìš©. apply ëŒ€ì‹ . ë°°ì—´ì„ í’€ì–´ì„œ ì „ë‹¬.
-->
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

// let cities =[];//ë˜ëŠ”
const cities=[];

// const prom =fetch(endpoint);//fetch(url,ì˜µì…˜), promise íƒ€ì„ì˜ ê°ì²´ ë°˜í™˜. api í˜¸ì¶œ ì„±ê³µí•˜ë©´ ì‘ë‹µ ê°ì²´ resolve, ì‹¤íŒ¨í•˜ë©´ error ê°ì²´ reject. ì˜µì…˜ì—ì„œëŠ” httpë°©ì‹,httpìš”ì²­ í—¤ë”,httpìš”ì²­ ì „ë¬¸ ë“± ì„¤ì •...??
// console.log(prom)
fetch(endpoint)//ë¯¸ë˜ ì‹œì ì— ì–»ê²Œ ë  API í˜¸ì¶œ ê²°ê³¼ ë¦¬í„´.
.then(blob => blob.json())//ì •ìƒì ì´ë©´ then ë©”ì„œë“œ í˜¸ì¶œ.(ìˆ˜í–‰í•  ë¡œì§) ë¹„ì •ìƒì ì´ë©´ catch í˜¸ì¶œ(ì˜ˆì™¸ ì²˜ë¦¬)
.then(data => cities.push(...data))

function findMatches(wordToMatch,cities) {
  return cities.filter(place=>{
    //here we need to figure out if the city or state matches what was searched
    const regex = new RegExp(wordToMatch,'gi');//new RegExp(íŒ¨í„´, í”Œë˜ê·¸))í•˜ë©´ ìƒˆë¡œìš´ RegExpê°ì²´ ìƒì„±. g: ë¬¸ìì—´ ì „ì²´ í™•ì¸ i: ëŒ€ì†Œë¬¸ì êµ¬ë¶„X 
    return place.city.match(regex) || place.state.match(regex)//formal language=regular expression= rational expression =regexp=regex íŠ¹ì •í•œ ë²•ì¹™ë“¤ë¡œ êµ¬ì„±ëœ ë¬¸ìì—´ë“¤ì˜ ì§‘í•©.
  })
}

function numberWithCommas(x){
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

function displayMatches() {
  const matchArray = findMatches(this.value, cities); //this.valueëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê²ƒ.
  const html = matchArray.map(place => {//matchArrayì˜ place ìš”ì†Œë¥¼ ë°˜ë³µë¬¸ ëŒë©° return ì´í›„ ìš”ì†Œë“¤ë¡œ ë°”ê¾¸ì–´ ìƒˆë¡œìš´ ë°°ì—´ ìƒì„±. ê·¸ ë°°ì—´ ì´ë¦„ì´ html
    const regex = new RegExp(this.value,'gi');
    const cityName= place.city.replace(regex, `<span class="hl">${this.value}</span>`)
    const stateName= place.state.replace(regex, `<span class="hl">${this.value}</span>`)
    return `
    <li>
      <span class="name">${cityName}, ${stateName}</span>
      <span class="population">${numberWithCommas(place.population)}</span>
    </li>
    `;
  }).join('');//ë°°ì—´ì˜ ì›ì†Œë“¤ ì—°ê²°. í•˜ë‚˜ì˜ ê°’ìœ¼ë¡œ ë§Œë“¤ê¸°.
  suggestions.innerHTML =html;//suggestionsì˜ HTMLì— html ë„£ê¸°
}

const searchInput=document.querySelector('.search');
const suggestions = document.querySelector('.suggestions');

searchInput.addEventListener('change',displayMatches);
searchInput.addEventListener('keyup',displayMatches);
</script>
</body>
</html>
